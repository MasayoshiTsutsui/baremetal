05-201020 筒井政成

課題Cをやるまでは、アドレス空間を決めているものが何なのか今ひとつ理解できていなかったのだが、cr3レジスタが指すテーブルが、アドレス空間を決めているのだということが強く実感できた。
52ビット数すべてのアドレスに対応するためには、本来は、ページテーブルにはすべてのエントリをセットしなければならないのだろうが、今回は使用するアドレスが限定されていたため、それらが使用するエントリだけを埋める作業をmemory.cで行った。
そしてコンテキストスイッチ時は、cr3レジスタに格納されている値を、次のタスクに割り当てられている仮想アドレス空間を作るP４テーブルの先頭アドレスに切り替えることで、正常なアドレス変換が行われるようになる。

また、今回の実装で遭遇したバグを1つ備忘録を兼ねて記しておく。
仮想アドレス空間に切り替わった状態で定義したローカル変数をそのままインラインアセンブラで使うと、（おそらく）segmentation faultを起こして、バグる。
理由は判然としないが、ページテーブルをすべて埋めていないことが関係している？
